(function(c){function t(b,f,m,e){e={data:e||0===e||!1===e?e:f?f.data:{},_wrap:f?f._wrap:null,tmpl:null,parent:f||null,nodes:[],calls:j,nest:D,wrap:x,html:E,update:F};b&&c.extend(e,b,{nodes:[],parent:f});m&&(e.tmpl=m,e._ctnt=e._ctnt||e.tmpl(c,e),e.key=++l,(a.length?u:n)[l]=e);return e}function v(b,f,a){var e;a=a?c.map(a,function(f){return"string"===typeof f?b.key?f.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+q+'="'+b.key+'" $2'):f:v(f,b,f._ctnt)}):b;if(f)return a;a=a.join("");a.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(b,f,a,m){e=c(a).get();y(e);f&&(e=w(f).concat(e));m&&(e=e.concat(w(m)))});return e?e:w(a)}function w(b){var f=document.createElement("div");f.innerHTML=b;return c.makeArray(f.childNodes)}function A(b){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+c.trim(b).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(b,a,e,g,h,k,d){b=c.tmpl.tag[e];if(!b)throw"Unknown template tag: "+e;e=b._default||[];k&&!/\w$/.test(h)&&(h+=k,k="");h?(h=r(h),d=d?","+r(d)+")":k?")":"",d=k?-1<h.indexOf(".")?h+r(k):"("+h+").call($item"+d:h,k=k?d:"(typeof("+h+")==='function'?("+h+").call($item):("+h+"))"):k=d=e.$1||"null";g=r(g);return"');"+b[a?"close":"open"].split("$notnull_1").join(h?"typeof("+h+")!=='undefined' && ("+h+")!=null":"true").split("$1a").join(k).split("$1").join(d).split("$2").join(g||e.$2||"")+"__.push('"})+
"');}return __;")}function d(b,f){b._wrap=v(b,!0,c.isArray(f)?f:[B.test(f)?f:c(f).html()]).join("")}function r(b){return b?b.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function y(b){function f(b){function f(b){b+=a;d=h[b]=h[b]||t(d,n[d.parent.key+a]||d.parent)}var e,g=b,d,k;if(k=b.getAttribute(q)){for(;g.parentNode&&1===(g=g.parentNode).nodeType&&!(e=g.getAttribute(q)););if(e!==k){g=g.parentNode?11===g.nodeType?0:g.getAttribute(q)||0:0;if(!(d=n[k]))d=u[k],d=t(d,n[g]||u[g]),d.key=++l,n[l]=d;p&&
f(k)}b.removeAttribute(q)}else if(p&&(d=c.data(b,"tmplItem")))f(d.key),n[d.key]=d,g=(g=c.data(b.parentNode,"tmplItem"))?g.key:0;if(d){for(e=d;e&&e.key!=g;)e.nodes.push(b),e=e.parent;delete d._ctnt;delete d._wrap;c.data(b,"tmplItem",d)}}var a="_"+p,e,g,h={},k,d,j;k=0;for(d=b.length;k<d;k++)if(1===(e=b[k]).nodeType){g=e.getElementsByTagName("*");for(j=g.length-1;0<=j;j--)f(g[j]);f(e)}}function j(b,f,c,e){if(!b)return a.pop();a.push({_:b,tmpl:f,item:this,data:c,options:e})}function D(b,f,a){return c.tmpl(c.template(b),
f,a,this)}function x(b,f){var a=b.options||{};a.wrapped=f;return c.tmpl(c.template(b.tmpl),b.data,a,b.item)}function E(b,f){var a=this._wrap;return c.map(c(c.isArray(a)?a.join(""):a).filter(b||"*"),function(b){if(f)b=b.innerText||b.textContent;else{var a;if(!(a=b.outerHTML))a=document.createElement("div"),a.appendChild(b.cloneNode(!0)),a=a.innerHTML;b=a}return b})}function F(){var b=this.nodes;c.tmpl(null,null,null,this).insertBefore(b[0]);c(b).remove()}var C=c.fn.domManip,q="_tmplitem",B=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,
n={},u={},s,z={key:0,data:{}},l=0,p=0,a=[];c.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,f){c.fn[b]=function(a){var e=[];a=c(a);var g,d,k;g=1===this.length&&this[0].parentNode;s=n||{};if(g&&11===g.nodeType&&1===g.childNodes.length&&1===a.length)a[f](this[0]),e=this;else{d=0;for(k=a.length;d<k;d++)p=d,g=(0<d?this.clone(!0):this).get(),c(a[d])[f](g),e=e.concat(g);p=0;e=this.pushStack(e,b,a.selector)}a=s;s=null;c.tmpl.complete(a);
return e}});c.fn.extend({tmpl:function(b,a,d){return c.tmpl(this[0],b,a,d)},tmplItem:function(){return c.tmplItem(this[0])},template:function(b){return c.template(b,this[0])},domManip:function(b,a,d,e){if(b[0]&&c.isArray(b[0])){for(var g=c.makeArray(arguments),h=b[0],k=h.length,j=0,l;j<k&&!(l=c.data(h[j++],"tmplItem")););l&&p&&(g[2]=function(b){c.tmpl.afterManip(this,b,d)});C.apply(this,g)}else C.apply(this,arguments);p=0;s||c.tmpl.complete(n);return this}});c.extend({tmpl:function(b,a,m,e){var g=
!e;if(g)e=z,b=c.template[b]||c.template(null,b),u={};else if(!b)return b=e.tmpl,n[e.key]=e,e.nodes=[],e.wrapped&&d(e,e.wrapped),c(v(e,null,e.tmpl(c,e)));if(!b)return[];"function"===typeof a&&(a=a.call(e||{}));m&&m.wrapped&&d(m,m.wrapped);a=c.isArray(a)?c.map(a,function(a){return a?t(m,e,b,a):null}):[t(m,e,b,a)];return g?c(v(e,null,a)):a},tmplItem:function(b){var a;for(b instanceof c&&(b=b[0]);b&&1===b.nodeType&&!(a=c.data(b,"tmplItem"))&&(b=b.parentNode););return a||z},template:function(b,a){return a?
("string"===typeof a?a=A(a):a instanceof c&&(a=a[0]||{}),a.nodeType&&(a=c.data(a,"tmpl")||c.data(a,"tmpl",A(a.innerHTML))),"string"===typeof b?c.template[b]=a:a):b?"string"!==typeof b?c.template(null,b):c.template[b]||c.template(null,B.test(b)?b:c(b)):null},encode:function(b){return(""+b).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});c.extend(c.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},
open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){n={}},afterManip:function(b,
a,d){var e=11===a.nodeType?c.makeArray(a.childNodes):1===a.nodeType?[a]:[];d.call(b,a);y(e);p++}})})(jQuery);
(function(){var c,t,v,w,A,d,r,y,j;j=this;c=j.jQuery;j.pte=d=d||{};d.fixThickbox=function(a){var b,c,d,e;b=a.jQuery;if(!(null===b||1>a.frames.length))if(log("===== FIXING THICKBOX ====="),e=j.options.pte_tb_width+30,d=j.options.pte_tb_height+38,c=b("#TB_window"),!(c.width()>=e&&c.height()>=d))return log("THICKBOX: "+c.width()+" x "+c.height()),c.css({"margin-left":0-e/2,width:e,height:d}).children("iframe").css({width:e}),a.setTimeout(function(){if(!(b("iframe",c).height()>d))return b("iframe",c).css({height:d}),
log("THICKBOX: "+c.width()+" x "+c.height()),!0},1E3)};y=function(a){return{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()};var D=function(a){this.message=a;this.date=new Date};D.prototype.toString=function(){var a,b,f,d,e,g,h;g=function(a,b){for(;(""+a).length<b;)a="0"+a;return a};f=this.date;h=g(f.getUTCFullYear(),4);b=g(f.getUTCMonth()+1,2);a=g(f.getUTCDate(),2);d=g(f.getUTCHours(),2);e=g(f.getUTCMinutes(),2);g=g(f.getUTCSeconds(),2);switch(y(this.message)){case "string":f=this.message;
break;default:f=c.toJSON(this.message)}return""+h+b+a+" "+d+":"+e+":"+g+" - ["+y(this.message)+"] "+f};d.messages=[];d.log=function(a){if(!j.options.pte_debug)return!0;try{d.messages.push(new D(a)),console.log(a),c("#pte-log-messages textarea").filter(":visible").val(d.formatLog())}catch(b){}};d.formatLog=function(){var a,b,c,m,e;a="";e=d.messages;c=0;for(m=e.length;c<m;c++)b=e[c],a+=""+b+"\n";return a};d.parseServerLog=function(a){var b,c,d;log("===== SERVER LOG =====");if(null!=(null!=a?a.length:
void 0)&&0<a.length){c=0;for(d=a.length;c<d;c++)b=a[c],log(b)}return!0};d.sendToPastebin=function(a){return c.ajax({url:"http://dpastey.appspot.com/",data:{title:"PostThumbnailEditor Log",content:a,lexer:"text",format:"json",expire_options:"2592000"},dataType:"json",global:!1,type:"POST",error:function(a,f,d){c("#pte-log").fadeOut("900");alert(objectL10n.pastebin_create_error);log(a);log(f);return log(d)},success:function(a){c("#pte-log").fadeOut("900");return prompt(objectL10n.pastebin_url,a.url)}})};
j.log=d.log;c(document).ready(function(a){a("#test").click(function(a){a.stopImmediatePropagation();return!0});a("#pastebin").click(function(){return d.sendToPastebin(d.formatLog())});a("#clear-log").click(function(){d.messages=[];return a("#pte-log-messages textarea").val(d.formatLog())});a("#close-log").click(function(){return a("#pte-log").fadeOut("900")});a("#pte-log-tools a").click(function(a){return a.preventDefault()});return a("body").delegate(".show-log-messages","click",function(b){b.preventDefault();
a("#pte-log-messages textarea").val(d.formatLog());return a("#pte-log").fadeIn("900")})});d.media=function(){var a;a=c("#tmpl-attachment-details").text();a=a.replace(/(<div class="compat-meta">)/,""+('<a target="_blank" href="'+ajaxurl+'?action=pte_ajax&pte-action=launch&id={{data.id}}">\n\t'+objectL10n.PTE+"\n</a>")+"\n$1");return c("#tmpl-attachment-details").text(a)};d.admin=function(){var a,b,f,d,e,g;g="&TB_iframe=true&height="+j.options.pte_tb_height+"&width="+j.options.pte_tb_width;f=null;e=
function(a){a=a||f||c("#attachment-id").val();return""+ajaxurl+"?action=pte_ajax&pte-action=launch&id="+a+g};a=function(a){return c('<a class="thickbox" href="'+e(a)+'">'+objectL10n.PTE+"</a>")};b=function(a){log("Start PTE...");if(0<j.parent.frames.length)return log("Modifying thickbox..."),j.parent.tb_click(),a.stopPropagation()};d=function(){var e;e=c("#imgedit-save-target-"+f);return 1>(null!=e?e.size():void 0)?(j.log("Edit Thumbnail Menu not visible, waiting for 300ms"),j.setTimeout(d,300),!1):
e.append(a().click(b))};var h;c(".media-item").each(function(e,f){var d;d=f.id.replace("media-item-","");return a(d).css({"font-size":".8em","margin-left":"5px"}).click(b).appendTo(c("tr.image-size th.label",f))});null!=imageEdit.open&&(imageEdit.oldopen=imageEdit.open,imageEdit.open=function(a,b){f=a;imageEdit.oldopen(a,b);return d()});h=c('p[id^="imgedit-save-target-"]');if(0<(null!=h?h.length:void 0))h=h[0].id.match(/imgedit-save-target-(\d+)/),null!=h[1]&&(f=h[1],d());return!0};var x=function(a,
b){this.fn=a;this.timeout=b;var c=this.doFunc,d=this;this.doFunc=function(){return c.apply(d,arguments)};this.timer=null};x.prototype.doFunc=function(){j.clearTimeout(this.timer);this.timer=j.setTimeout(this.fn,this.timeout);return!0};j.randomness=function(){return Math.floor(1000001*Math.random()).toString(16)};j.debugTmpl=function(a){log("===== TEMPLATE DEBUG DATA FOLLOWS =====");log(a);return!0};t=function(a){a={id:a,action:"pte_ajax","pte-action":"delete-images","pte-nonce":c("#pte-delete-nonce").val()};
return c.ajax({url:ajaxurl,data:a,global:!1,dataType:"json",success:v})};v=function(a){log("===== DELETE SUCCESSFUL, DATA DUMP FOLLOWS =====");log(a);return d.parseServerLog(a.log)};r=c({});c.fn.extend({move:function(a){a=c.extend({direction:"left",speed:500,easing:"swing",toggle:!0,callback:null,callbackargs:null},a);this.each(function(){var b=this;return r.queue(function(f){var d,e,g,h;d=c(b);e="left"===a.direction?-1:1;h="0px"===d.css("left")?c(j).width()*e:0;g=d.is(":visible");log([e,h,g]);g?
(d.animate({left:h},a.speed,a.easing),d.hide(0,f)):d.show(0,function(){return c(this).animate({left:h},a.speed,a.easing,f)});return!0})});null!=a.callback&&r.queue(function(b){null!=a.callbackargs?(log("running callback with arguments"),a.callback.apply(this,a.callbackargs)):(log("running callback with no arguments"),a.callback.apply(this));log("finished running callback");return b()});return this},moveRight:function(a){a=c.extend(a,{direction:"right"});return this.move(a)},moveLeft:function(a){a=
c.extend(a,{direction:"left"});return this.move(a)}});j.goBack=function(a){null!=a&&a.preventDefault();c("#stage2").moveRight();c("#stage1").moveRight({callback:function(){t(c("#pte-post-id").val());return c("#stage2").html("")}});return!0};A=function(a,b){if(0===a)return b;for(;0<b;)a>b?a-=b:b-=a;return 0>a||0>b?null:a};w=function(a,b){var c,d,e,g;c=b.crop;g=b.width;e=b.height;c=+c;g=+g;e=+e;d=A(g,e);if(null!=c&&0<c){c=null;null!=g&&(0<g&&null!=e&&0<e)&&(c=null!=d?""+g/d+":"+e/d:""+g+":"+e);if(null!=
a&&null!=c&&c!==a)throw objectL10n.aspect_ratio_disabled;a=c}return a};d.functions={determineAspectRatio:w};var E,F,C,q,B,n,u,s,z,l,p;d.editor=function(){u();C();p();F();q();B();E();n();return!0};n=function(){var a,b;a=c("#pte-loading");b=function(){a.hide();return!0};c("#pte-preview").load(b);a.ajaxStart(function(){return c(this).fadeIn(200)}).ajaxStop(function(){return c(this).fadeOut(200)});j.setTimeout(b,2E3);return!0};u=function(){var a;a=new x(function(){var a;log("===== REFLOW =====");d.fixThickbox(j.parent);
a=c("#pte-sizes").offset();a=c(j).height()-a.top-2;c("#pte-sizes").height(a);log("WINDOW WIDTH: "+c(j).width());c("#stage2, #stage3").filter(":hidden").css({left:c(j).width()});return!0},100);c(j).resize(a.doFunc).load(a.doFunc);return!0};C=function(){var a;a=function(a){a.delegate("tr","click",function(a){"checkbox"!==a.target.type&&c("input:checkbox",this).click();return!0});return a.delegate("input:checkbox","click",function(){this.checked||c(this).is("input:checked")?c(this).parents("tr").first().removeClass("selected"):
c(this).parents("tr").first().addClass("selected");return!0})};a(c("#stage2"));return a(c("#stage1"))};l=null;z={keys:!0,minWidth:3,minHeight:3,handles:!0,zIndex:1200,instance:!0,onSelectEnd:function(a,b){return b.width&&0<b.width&&b.height&&0<b.height&&0<c(".pte-size").filter(":checked").size()?c("#pte-submit").removeAttr("disabled"):c("#pte-submit").attr("disabled",!0)}};p=function(){return d.ias=l=c("#pte-image img").imgAreaSelect(z)};s=function(a){log("===== SETTING ASPECTRATIO: "+a+" =====");
l.setOptions({aspectRatio:a});return l.update()};F=function(){var a,b;b=new x(function(){log("===== CHECK SUBMIT BUTTON =====");0<c(".pte-confirm").filter(":checked").size()?(log("ENABLE"),c("#pte-confirm").removeAttr("disabled")):(log("DISABLE"),c("#pte-confirm").attr("disabled",!0));return!0},50);a=new x(function(){var a;a=null;c("input.pte-size").filter(":checked").each(function(b,e){try{a=w(a,thumbnail_info[c(e).val()])}catch(d){return a=null,a!==l.getOptions().aspectRatio&&log("Setting Aspect Ratio to null"),
!1}return!0});s(a);z.onSelectEnd(null,l.getSelection());return!0},50);c.extend(d.functions,{pteVerifySubmitButtonHandler:b});c("input.pte-size").click(a.doFunc);return c(".pte-confirm").live("click",function(){return b.doFunc()})};q=function(){var a;c("#pte-submit").click(function(){var b,d;d=l.getSelection();b=c("#pte-sizer").val();b={id:c("#pte-post-id").val(),action:"pte_ajax","pte-action":"resize-images","pte-sizes[]":c(".pte-size").filter(":checked").map(function(){return c(this).val()}).get(),
x:Math.floor(d.x1/b),y:Math.floor(d.y1/b),w:Math.floor(d.width/b),h:Math.floor(d.height/b)};log("===== RESIZE-IMAGES =====");log(b);if(isNaN(b.x)||isNaN(b.y)||isNaN(b.w)||isNaN(b.h))return alert(objectL10n.crop_submit_data_error),log("ERROR with submit_data and NaN's"),!1;l.setOptions({hide:!0,x1:0,y1:0,x2:0,y2:0});c("#pte-submit").attr("disabled",!0);c.getJSON(ajaxurl,b,a);return!0});return a=function(a){log("===== RESIZE-IMAGES SUCCESS =====");log(a);d.parseServerLog(a.log);if(null!=a.error&&null==
a.thumbnails)alert(a.error);else return c("#stage1").moveLeft(),c("#stage2").html(c("#stage2template").tmpl(a)).moveLeft({callback:d.functions.pteVerifySubmitButtonHandler.doFunc}),!1}};B=function(){var a;c("#pte-confirm").live("click",function(){var b,d;d={};c("input.pte-confirm").filter(":checked").each(function(a,b){var g;g=c(b).val();return d[g]=c(b).parent().parent().find(".pte-file").val()});b={id:c("#pte-post-id").val(),action:"pte_ajax","pte-action":"confirm-images","pte-nonce":c("#pte-nonce").val(),
"pte-confirm":d};log("===== CONFIRM-IMAGES =====");log(b);return c.getJSON(ajaxurl,b,a)});return a=function(a){log("===== CONFIRM-IMAGES SUCCESS =====");log(a);d.parseServerLog(a.log);c("#stage2").moveLeft();c("#stage3").html(c("#stage3template").tmpl(a)).moveLeft();return!1}};E=function(){var a,b;b=function(a){var b,d;null!=a&&a.preventDefault();a=null!=(b=null!=(d=a.data)?d.selector:void 0)?b:".pte-size";return c(a).filter(":checked").click()};a=function(a){var b,d;null!=a&&a.preventDefault();a=
null!=(b=null!=a?null!=(d=a.data)?d.selector:void 0:void 0)?b:".pte-size";return c(a).not(":checked").click()};c("#pte-selectors .all").click(a);c("#pte-selectors .none").click(b).click();c("#stage2").delegate("#pte-stage2-selectors .all","click",{selector:".pte-confirm"},a);c("#stage2").delegate("#pte-stage2-selectors .none","click",{selector:".pte-confirm"},b);return!0};c.extend(d.functions,{iasSetAR:s})}).call(this);
